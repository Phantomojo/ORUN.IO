<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Globe.gl Enhanced - Professional Data Visualization</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #fff;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #globe-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
            backdrop-filter: blur(10px);
        }
        
        .controls h3 {
            margin: 0 0 15px 0;
            color: #00ff88;
            font-size: 18px;
        }
        
        .controls button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            background: #111;
            color: #fff;
            border: 1px solid #333;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .controls button:hover {
            background: #222;
            border-color: #00ff88;
        }
        
        .controls button.active {
            background: #00ff88;
            color: #000;
        }
        
        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
            min-width: 250px;
            backdrop-filter: blur(10px);
        }
        
        .info-panel h4 {
            margin: 0 0 10px 0;
            color: #00ff88;
        }
        
        .info-panel .stat {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            text-align: center;
        }
        
        .loading h2 {
            color: #00ff88;
            margin-bottom: 20px;
        }
        
        .loading .progress {
            width: 400px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .loading .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #0088ff);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .performance-stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #333;
            font-size: 12px;
            backdrop-filter: blur(10px);
        }
        
        .data-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #333;
            min-width: 200px;
            backdrop-filter: blur(10px);
        }
        
        .data-panel h4 {
            margin: 0 0 10px 0;
            color: #00ff88;
        }
        
        .data-panel .data-item {
            margin: 5px 0;
            font-size: 12px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            text-align: center;
            background: rgba(255, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ff0000;
        }
        
        .error h3 {
            margin: 0 0 10px 0;
            color: white;
        }
        
        .error button {
            margin-top: 10px;
            padding: 10px 20px;
            background: white;
            color: red;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="globe-container"></div>
        
        <div class="loading" id="loading">
            <h2>Loading React Globe.gl Enhanced</h2>
            <div class="progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div id="loading-text">Loading...</div>
        </div>
        
        <div class="controls" id="controls" style="display: none;">
            <h3>React Globe.gl Controls</h3>
            <button onclick="toggleAutoRotate()" id="rotate-btn">Auto Rotate</button>
            <button onclick="togglePoints()" id="points-btn">Show Data Points</button>
            <button onclick="toggleArcs()" id="arcs-btn">Show Arcs</button>
            <button onclick="toggleCountries()" id="countries-btn">Show Countries</button>
            <button onclick="toggleBorders()" id="borders-btn">Show Borders</button>
            <button onclick="toggleLabels()" id="labels-btn">Labels</button>
            <button onclick="changeMapStyle()">Change Map Style</button>
            <button onclick="resetView()">Reset View</button>
        </div>
        
        <div class="info-panel" id="info-panel" style="display: none;">
            <h4>Globe Statistics</h4>
            <div class="stat">Library: <span id="library">React Globe.gl</span></div>
            <div class="stat">Data Points: <span id="data-points">0</span></div>
            <div class="stat">Arcs: <span id="arcs-count">0</span></div>
            <div class="stat">FPS: <span id="fps">0</span></div>
            <div class="stat">Render Mode: <span id="render-mode">Enhanced</span></div>
        </div>
        
        <div class="data-panel" id="data-panel">
            <h4>Data Visualization</h4>
            <div class="data-item">Population: <span id="population">-</span></div>
            <div class="data-item">GDP: <span id="gdp">-</span></div>
            <div class="data-item">Connections: <span id="connections">-</span></div>
            <div class="data-item">Active Layer: <span id="active-layer">Globe</span></div>
        </div>
        
        <div class="performance-stats" id="perf-stats">
            <div>Frame Time: <span id="frame-time">0</span>ms</div>
            <div>Memory: <span id="memory-usage">0</span>MB</div>
            <div>WebGL: <span id="webgl-info">Enabled</span></div>
        </div>
    </div>

    <!-- Load libraries with fallbacks -->
    <script>
        // Global variables
        let globeRef;
        let autoRotate = false;
        let showPoints = true;
        let showArcs = true;
        let showCountries = false;
        let showBorders = false;
        let showLabels = false;
        let currentMapStyle = 0;
        let librariesLoaded = 0;
        let totalLibraries = 4;
        
        // Performance tracking
        let frameCount = 0;
        let lastTime = 0;
        let fps = 0;
        
        // Sample data for visualization
        const sampleData = {
            points: [
                { lat: 40.7128, lng: -74.0060, size: 0.5, color: 'red', name: 'New York' },
                { lat: 51.5074, lng: -0.1278, size: 0.5, color: 'blue', name: 'London' },
                { lat: 35.6762, lng: 139.6503, size: 0.5, color: 'green', name: 'Tokyo' },
                { lat: -33.8688, lng: 151.2093, size: 0.5, color: 'yellow', name: 'Sydney' },
                { lat: -22.9068, lng: -43.1729, size: 0.5, color: 'purple', name: 'Rio de Janeiro' },
                { lat: 55.7558, lng: 37.6176, size: 0.5, color: 'orange', name: 'Moscow' },
                { lat: 19.0760, lng: 72.8777, size: 0.5, color: 'cyan', name: 'Mumbai' },
                { lat: -26.2041, lng: 28.0473, size: 0.5, color: 'magenta', name: 'Johannesburg' }
            ],
            arcs: [
                { startLat: 40.7128, startLng: -74.0060, endLat: 51.5074, endLng: -0.1278, color: 'red' },
                { startLat: 51.5074, startLng: -0.1278, endLat: 35.6762, endLng: 139.6503, color: 'blue' },
                { startLat: 35.6762, endLng: 139.6503, startLat: -33.8688, endLng: 151.2093, color: 'green' },
                { startLat: -33.8688, startLng: 151.2093, endLat: -22.9068, endLng: -43.1729, color: 'yellow' },
                { startLat: -22.9068, startLng: -43.1729, endLat: 55.7558, endLng: 37.6176, color: 'purple' },
                { startLat: 55.7558, startLng: 37.6176, endLat: 19.0760, endLng: 72.8777, color: 'orange' },
                { startLat: 19.0760, startLng: 72.8777, endLat: -26.2041, endLng: 28.0473, color: 'cyan' },
                { startLat: -26.2041, startLng: 28.0473, endLat: 40.7128, endLng: -74.0060, color: 'magenta' }
            ],
            labels: [
                { lat: 40.7128, lng: -74.0060, text: 'New York', size: 1, color: 'white' },
                { lat: 51.5074, lng: -0.1278, text: 'London', size: 1, color: 'white' },
                { lat: 35.6762, lng: 139.6503, text: 'Tokyo', size: 1, color: 'white' },
                { lat: -33.8688, lng: 151.2093, text: 'Sydney', size: 1, color: 'white' }
            ],
            // Country borders and names
            countries: [
                { name: 'United States', lat: 39.8283, lng: -98.5795, color: '#ff6b6b' },
                { name: 'United Kingdom', lat: 55.3781, lng: -3.4360, color: '#4ecdc4' },
                { name: 'Japan', lat: 36.2048, lng: 138.2529, color: '#45b7d1' },
                { name: 'Australia', lat: -25.2744, lng: 133.7751, color: '#96ceb4' },
                { name: 'Brazil', lat: -14.2350, lng: -51.9253, color: '#feca57' },
                { name: 'Russia', lat: 61.5240, lng: 105.3188, color: '#ff9ff3' },
                { name: 'India', lat: 20.5937, lng: 78.9629, color: '#54a0ff' },
                { name: 'South Africa', lat: -30.5595, lng: 22.9375, color: '#5f27cd' },
                { name: 'China', lat: 35.8617, lng: 104.1954, color: '#00d2d3' },
                { name: 'Canada', lat: 56.1304, lng: -106.3468, color: '#ff9f43' },
                { name: 'Germany', lat: 51.1657, lng: 10.4515, color: '#a55eea' },
                { name: 'France', lat: 46.2276, lng: 2.2137, color: '#26de81' }
            ],
            // Country polygons for borders (simplified)
            countryPolygons: [
                // United States (simplified)
                { 
                    name: 'United States', 
                    color: '#ff6b6b',
                    polygon: [
                        { lat: 49, lng: -125 }, { lat: 49, lng: -66 }, { lat: 25, lng: -66 },
                        { lat: 25, lng: -97 }, { lat: 30, lng: -97 }, { lat: 30, lng: -80 },
                        { lat: 25, lng: -80 }, { lat: 25, lng: -66 }, { lat: 49, lng: -125 }
                    ]
                },
                // China (simplified)
                { 
                    name: 'China', 
                    color: '#00d2d3',
                    polygon: [
                        { lat: 54, lng: 73 }, { lat: 54, lng: 135 }, { lat: 18, lng: 135 },
                        { lat: 18, lng: 73 }, { lat: 54, lng: 73 }
                    ]
                },
                // Brazil (simplified)
                { 
                    name: 'Brazil', 
                    color: '#feca57',
                    polygon: [
                        { lat: 5, lng: -60 }, { lat: 5, lng: -35 }, { lat: -34, lng: -35 },
                        { lat: -34, lng: -60 }, { lat: 5, lng: -60 }
                    ]
                },
                // Australia (simplified)
                { 
                    name: 'Australia', 
                    color: '#96ceb4',
                    polygon: [
                        { lat: -10, lng: 113 }, { lat: -10, lng: 154 }, { lat: -44, lng: 154 },
                        { lat: -44, lng: 113 }, { lat: -10, lng: 113 }
                    ]
                },
                // India (simplified)
                { 
                    name: 'India', 
                    color: '#54a0ff',
                    polygon: [
                        { lat: 37, lng: 68 }, { lat: 37, lng: 97 }, { lat: 6, lng: 97 },
                        { lat: 6, lng: 68 }, { lat: 37, lng: 68 }
                    ]
                },
                // Russia (simplified)
                { 
                    name: 'Russia', 
                    color: '#ff9ff3',
                    polygon: [
                        { lat: 82, lng: 19 }, { lat: 82, lng: -169 }, { lat: 41, lng: -169 },
                        { lat: 41, lng: 19 }, { lat: 82, lng: 19 }
                    ]
                }
            ]
        };
        
        // Map styles
        const MAP_STYLES = [
            {
                name: "NASA Topography",
                url: "world-map-topography.jpg",
                description: "NASA Earth Observatory topographic map"
            },
            {
                name: "NASA Night Lights",
                url: "world-map-night.jpg",
                description: "NASA night lights view of Earth"
            },
            {
                name: "NASA Blue Marble",
                url: "world-map-blue-marble.jpg",
                description: "NASA Blue Marble satellite view"
            },
            {
                name: "Satellite with Borders",
                url: "world-satellite-base.jpg",
                description: "NASA satellite imagery with country borders"
            },
            {
                name: "Political Map",
                url: "world-map-political.png",
                description: "Political world map with country borders"
            },
            {
                name: "High-Res Satellite",
                url: "world-map-4k.jpg",
                description: "High-resolution satellite imagery"
            }
        ];
        
        // Library loading with fallbacks
        function loadScript(src, onLoad, onError) {
            const script = document.createElement('script');
            script.src = src;
            script.onload = onLoad;
            script.onerror = onError;
            document.head.appendChild(script);
        }
        
        function onLibraryLoaded(name) {
            librariesLoaded++;
            updateProgress((librariesLoaded / totalLibraries) * 100, `Loaded ${name}...`);
            console.log(`${name} loaded successfully`);
            
            // Debug: Log what's available in global scope
            if (name === 'React Globe.gl') {
                console.log('Global objects available:', Object.keys(window).filter(key => key.includes('React') || key.includes('Globe')));
                console.log('window.Globe:', typeof window.Globe);
                console.log('window.ReactGlobeGl:', typeof window.ReactGlobeGl);
            }
            
            if (librariesLoaded === totalLibraries) {
                setTimeout(() => {
                    initGlobe();
                }, 500);
            }
        }
        
        function onLibraryError(name, src) {
            console.error(`Failed to load ${name} from ${src}`);
            // Try fallback CDN
            const fallbackSrc = getFallbackSrc(name);
            if (fallbackSrc) {
                console.log(`Trying fallback for ${name}...`);
                loadScript(fallbackSrc, () => onLibraryLoaded(name), () => {
                    console.error(`All sources failed for ${name}`);
                    showError(`Failed to load ${name}. Please check your internet connection.`);
                });
            } else {
                showError(`Failed to load ${name}. Please check your internet connection.`);
            }
        }
        
        function getFallbackSrc(libraryName) {
            const fallbacks = {
                'React': 'https://unpkg.com/react@18/umd/react.production.min.js',
                'ReactDOM': 'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js',
                'Three.js': 'https://unpkg.com/three@0.158.0/build/three.min.js',
                'React Globe.gl': 'https://unpkg.com/react-globe.gl@2.33.2/dist/react-globe.gl.js'
            };
            return fallbacks[libraryName];
        }
        
        // Initialize the application
        function init() {
            updateProgress(10, "Loading libraries...");
            
            // Load libraries in order with fallbacks
            loadScript('./three.min.js', () => onLibraryLoaded('Three.js'), () => onLibraryError('Three.js', './three.min.js'));
            loadScript('./react.min.js', () => onLibraryLoaded('React'), () => onLibraryError('React', './react.min.js'));
            loadScript('./react-dom.min.js', () => onLibraryLoaded('ReactDOM'), () => onLibraryError('ReactDOM', './react-dom.min.js'));
            loadScript('./react-globe.gl.min.js', () => onLibraryLoaded('React Globe.gl'), () => onLibraryError('React Globe.gl', './react-globe.gl.min.js'));
        }
        
        // Initialize the globe
        function initGlobe() {
            updateProgress(80, "Initializing React Globe.gl...");
            
            // Check if all required libraries are available
            if (typeof window.React === 'undefined' || typeof window.ReactDOM === 'undefined' || typeof window.Globe === 'undefined') {
                console.log('React available:', typeof window.React !== 'undefined');
                console.log('ReactDOM available:', typeof window.ReactDOM !== 'undefined');
                console.log('Globe available:', typeof window.Globe !== 'undefined');
                showError('Required libraries not loaded. Please refresh the page.');
                return;
            }
            
            // Create React Globe component
            const GlobeComponent = () => {
                const [globeData, setGlobeData] = React.useState({
                    points: sampleData.points,
                    arcs: sampleData.arcs,
                    labels: sampleData.labels,
                    countries: sampleData.countries,
                    countryPolygons: sampleData.countryPolygons
                });
                
                const [displaySettings, setDisplaySettings] = React.useState({
                    showPoints: true,
                    showArcs: true,
                    showCountries: false,
                    showBorders: false,
                    showLabels: false,
                    autoRotate: false,
                    mapStyle: 0
                });
                
                // Update global variables when state changes
                React.useEffect(() => {
                    showPoints = displaySettings.showPoints;
                    showArcs = displaySettings.showArcs;
                    showCountries = displaySettings.showCountries;
                    showBorders = displaySettings.showBorders;
                    showLabels = displaySettings.showLabels;
                    autoRotate = displaySettings.autoRotate;
                    currentMapStyle = displaySettings.mapStyle;
                }, [displaySettings]);
                
                React.useEffect(() => {
                    updateProgress(90, "Setting up data layers...");
                    
                    // Update statistics
                    document.getElementById('data-points').textContent = globeData.points.length;
                    document.getElementById('arcs-count').textContent = globeData.arcs.length;
                    
                    updateProgress(100, "React Globe.gl ready!");
                    
                    setTimeout(() => {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('controls').style.display = 'block';
                        document.getElementById('info-panel').style.display = 'block';
                    }, 500);
                }, []);
                
                // Create combined labels for countries and cities
                const allLabels = [
                    ...(displaySettings.showLabels ? globeData.labels : []),
                    ...(displaySettings.showCountries ? globeData.countries.map(country => ({
                        lat: country.lat,
                        lng: country.lng,
                        text: country.name,
                        size: 0.8,
                        color: country.color
                    })) : [])
                ];
                
                // Auto-enable borders for satellite with borders map style
                const shouldShowBorders = displaySettings.showBorders || 
                    (displaySettings.mapStyle === 3); // Satellite with Borders is index 3
                
                return React.createElement('div', {
                    style: { width: '100%', height: '100%' }
                }, React.createElement(window.Globe, {
                    ref: (ref) => { 
                        globeRef = ref;
                        // Store the setDisplaySettings function globally for controls
                        window.setDisplaySettings = setDisplaySettings;
                    },
                    width: window.innerWidth,
                    height: window.innerHeight,
                    backgroundColor: '#000011',
                    globeImageUrl: MAP_STYLES[displaySettings.mapStyle].url,
                    pointsData: displaySettings.showPoints ? globeData.points : [],
                    arcsData: displaySettings.showArcs ? globeData.arcs : [],
                    labelsData: allLabels,
                    polygonsData: shouldShowBorders ? globeData.countryPolygons : [],
                    onGlobeReady: () => {
                        console.log('React Globe.gl ready!');
                        updateProgress(95, "Globe ready, adding data layers...");
                        
                        // Set up auto-rotation
                        if (displaySettings.autoRotate && globeRef) {
                            globeRef.controls().autoRotate = true;
                            globeRef.controls().autoRotateSpeed = 0.5;
                        }
                    },
                    onError: (error) => {
                        console.error('Globe error:', error);
                        showError('Globe initialization failed: ' + error.message);
                    },
                    onPointClick: (point) => {
                        console.log('Point clicked:', point);
                        updateDataPanel(point);
                    },
                    onArcClick: (arc) => {
                        console.log('Arc clicked:', arc);
                    },
                    pointColor: 'color',
                    pointAltitude: 0.01,
                    pointRadius: 0.5,
                    arcColor: 'color',
                    arcDashLength: 0.4,
                    arcDashGap: 0.2,
                    arcDashAnimateTime: 2000,
                    labelText: 'text',
                    labelSize: 1,
                    labelColor: 'color',
                    labelAltitude: 0.02,
                    polygonCapColor: 'color',
                    polygonSideColor: 'color',
                    polygonAltitude: 0.02,
                    polygonCapMaterial: { transparent: true, opacity: 0.4 },
                    polygonSideMaterial: { transparent: true, opacity: 0.2 },
                    polygonStrokeColor: '#ffffff',
                    polygonStrokeWidth: 2,
                    enablePointerInteraction: true,
                    animateIn: true
                }));
            };
            
            // Render the globe
            try {
                const root = window.ReactDOM.createRoot(document.getElementById('globe-container'));
                root.render(React.createElement(GlobeComponent));
                
                // Start performance monitoring
                startPerformanceMonitoring();
                
                // Set a timeout to check if globe rendered
                setTimeout(() => {
                    const globeElement = document.querySelector('#globe-container canvas');
                    if (!globeElement) {
                        console.warn('Globe canvas not found, trying fallback...');
                        showError('Globe failed to render. Please refresh the page.');
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Error rendering globe:', error);
                showError('Failed to render globe: ' + error.message);
            }
        }
        
        // Start performance monitoring
        function startPerformanceMonitoring() {
            function monitorPerformance() {
                const currentTime = performance.now();
                const deltaTime = currentTime - lastTime;
                lastTime = currentTime;
                
                frameCount++;
                if (frameCount % 60 === 0) {
                    fps = Math.round(1000 / deltaTime);
                    document.getElementById('fps').textContent = fps;
                }
                
                updatePerformanceStats(deltaTime);
                requestAnimationFrame(monitorPerformance);
            }
            
            requestAnimationFrame(monitorPerformance);
        }
        
        // Update progress bar
        function updateProgress(percent, text) {
            document.getElementById('progress-bar').style.width = percent + '%';
            document.getElementById('loading-text').textContent = text;
        }
        
        // Update performance statistics
        function updatePerformanceStats(frameTime) {
            document.getElementById('frame-time').textContent = frameTime.toFixed(1);
            
            // Mock memory usage
            const memoryUsage = 60 + Math.random() * 20;
            document.getElementById('memory-usage').textContent = memoryUsage.toFixed(1);
        }
        
        // Update data panel
        function updateDataPanel(data) {
            document.getElementById('population').textContent = Math.floor(Math.random() * 10000000).toLocaleString();
            document.getElementById('gdp').textContent = '$' + Math.floor(Math.random() * 1000000000000).toLocaleString();
            document.getElementById('connections').textContent = Math.floor(Math.random() * 100);
            document.getElementById('active-layer').textContent = data.name || 'Unknown';
        }
        
        // Show error message
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.innerHTML = `
                <h3>Error</h3>
                <p>${message}</p>
                <button onclick="location.reload()">Retry</button>
            `;
            document.getElementById('container').appendChild(errorDiv);
        }
        
        // Control functions
        function toggleAutoRotate() {
            if (window.setDisplaySettings) {
                window.setDisplaySettings(prev => {
                    const newAutoRotate = !prev.autoRotate;
                    
                    // Update the globe controls immediately
                    if (globeRef && globeRef.controls) {
                        globeRef.controls().autoRotate = newAutoRotate;
                        globeRef.controls().autoRotateSpeed = 0.5;
                    }
                    
                    return {
                        ...prev,
                        autoRotate: newAutoRotate
                    };
                });
                document.getElementById('rotate-btn').classList.toggle('active', !autoRotate);
                console.log('Auto rotate toggled');
            }
        }
        
        function togglePoints() {
            if (window.setDisplaySettings) {
                window.setDisplaySettings(prev => ({
                    ...prev,
                    showPoints: !prev.showPoints
                }));
                document.getElementById('points-btn').classList.toggle('active', !showPoints);
                console.log('Points toggled');
            }
        }
        
        function toggleArcs() {
            if (window.setDisplaySettings) {
                window.setDisplaySettings(prev => ({
                    ...prev,
                    showArcs: !prev.showArcs
                }));
                document.getElementById('arcs-btn').classList.toggle('active', !showArcs);
                console.log('Arcs toggled');
            }
        }
        
        function toggleCountries() {
            if (window.setDisplaySettings) {
                window.setDisplaySettings(prev => ({
                    ...prev,
                    showCountries: !prev.showCountries
                }));
                document.getElementById('countries-btn').classList.toggle('active', !showCountries);
                console.log('Countries toggled');
            }
        }
        
        function toggleBorders() {
            if (window.setDisplaySettings) {
                window.setDisplaySettings(prev => ({
                    ...prev,
                    showBorders: !prev.showBorders
                }));
                document.getElementById('borders-btn').classList.toggle('active', !showBorders);
                console.log('Borders toggled');
            }
        }
        
        function toggleLabels() {
            if (window.setDisplaySettings) {
                window.setDisplaySettings(prev => ({
                    ...prev,
                    showLabels: !prev.showLabels
                }));
                document.getElementById('labels-btn').classList.toggle('active', !showLabels);
                console.log('Labels toggled');
            }
        }
        
        function changeMapStyle() {
            if (window.setDisplaySettings) {
                window.setDisplaySettings(prev => ({
                    ...prev,
                    mapStyle: (prev.mapStyle + 1) % MAP_STYLES.length
                }));
                const newMap = MAP_STYLES[(currentMapStyle + 1) % MAP_STYLES.length];
                console.log(`Switched to ${newMap.name}`);
            }
        }
        
        function resetView() {
            if (globeRef) {
                globeRef.pointOfView({ lat: 0, lng: 0, altitude: 2.5 });
                console.log('View reset');
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (globeRef) {
                // React Globe.gl handles resize automatically
                console.log('Window resized, globe will auto-adjust');
            }
        });
        
        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
